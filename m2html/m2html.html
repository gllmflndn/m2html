<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of m2html</title>
  <meta name="keywords" content="m2html">
  <meta name="description" content="M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">m2html</a> &gt; m2html.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for m2html&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>m2html
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function m2html(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML
  M2HTML by itself generates an HTML documentation of the Matlab M-files found
  in the direct subdirectories of the current directory. HTML files are 
  written in a 'doc' directory (created if necessary). All the others options
  are set to default (in brackets in the following).
  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)
  sets multiple option values. The list of option names and default values is:
    o mFiles - Cell array of strings or character array containing the
       list of M-files and/or directories of M-files for which an HTML
       documentation will be built (use relative paths without backtracking).
       Launch M2HTML one directory above the directory your wanting to
       generate documentation for  [ &lt;all direct subdirectories&gt; ]
    o htmlDir - Top level directory for generated HTML files [ 'doc' ]
    o recursive - Process subdirectories recursively [ on | {off} ]
    o source - Include Matlab source code in the generated documentation
                               [ {on} | off ]
    o download - Add a link to download each M-file separately [ on | {off} ]
    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]
    o tabs - Replace '\t' (horizontal tab) in source code by n white space
        characters [ 0 ... {4} ... n ]
    o globalHypertextLinks - Hypertext links among separate Matlab 
        directories [ on | {off} ]
    o todo - Create a TODO list in each directory summarizing all the
        '% TODO %' lines found in Matlab code [ on | {off}]
    o graph - Compute a dependency graph using GraphViz [ on | {off}]
        'dot' required, see &lt;http://www.graphviz.org/&gt;
    o indexFile - Basename of the HTML index file [ 'index' ]
    o extension - Extension of generated HTML files [ '.html' ]
    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]
    o search - Add a PHP search engine [ on | {off}] - beta version!
    o ignoredDir - List of directories to be ignored [ {'.svn','.git','.github','.hg'} ]
    o save - Save current state after M-files parsing in 'm2html.mat' 
        in directory htmlDir [ on | {off}]
    o load - Load a previously saved '.mat' M2HTML state to generate HTML 
        files once again with possibly other options [ &lt;none&gt; ]
    o verbose - Verbose mode [ {on} | off ]

  For more information, please read the M2HTML tutorial and FAQ at:
    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;

  Examples:
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');
    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');
    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');
    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');
    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>	TEMPLATE/GET Access data stored in a Template object</li><li><a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>	TEMPLATE/PARSE Fill in replacement fields with the class properties</li><li><a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>	TEMPLATE/SET Edit data stored in a Template object</li><li><a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>	TEMPLATE HTML Template Toolbox Constructor</li><li><a href="../m2html/private/doxywrite.html" class="code" title="function doxywrite(filename, kw, statinfo, docinfo)">doxywrite</a>	DOXYWRITE Write a 'search.idx' file compatible with DOXYGEN</li><li><a href="../m2html/private/mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>	MDOT - Export a dependency graph into DOT language</li><li><a href="../m2html/private/mexexts.html" class="code" title="function ext = mexexts">mexexts</a>	List of MEX files extensions</li><li><a href="../m2html/private/mfileparse.html" class="code" title="function s = mfileparse(mfile, mdirs, names, options)">mfileparse</a>	MFILEPARSE Parsing of an M-file to obtain synopsis, help and references</li><li><a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>	OPENFILE Open a file in read/write mode, catching errors</li><li><a href="../m2html/private/searchindex.html" class="code" title="function [s, freq] = searchindex(mfile, szmin)">searchindex</a>	SEARCHINDEX Compute keywords statistics of an M-file</li><li><a href="../m2html/private/splitcode.html" class="code" title="function splitc = splitcode(code)">splitcode</a>	SPLITCODE Split a line of Matlab code in string, comment and other</li><li><a href="../m2html/private/strtok2.html" class="code" title="function [token, remainder, quotient] = strtok2(string, delimiters)">strtok2</a>	Modified version of STRTOK to also return the quotient</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive,ignoredDir)</a></li><li><a href="#_sub2" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a></li><li><a href="#_sub3" class="code">function s = backtomaster(mdir)</a></li><li><a href="#_sub4" class="code">function ldir = splitpath(p)</a></li><li><a href="#_sub5" class="code">function name = extractname(synopsis)</a></li><li><a href="#_sub6" class="code">function f = fullurl(varargin)</a></li><li><a href="#_sub7" class="code">function str = escapeblank(str)</a></li><li><a href="#_sub8" class="code">function str = entity(str)</a></li><li><a href="#_sub9" class="code">function str = horztab(str,n)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function m2html(varargin)</a>
0002 <span class="comment">%M2HTML - Documentation Generator for Matlab M-files and Toolboxes in HTML</span>
0003 <span class="comment">%  M2HTML by itself generates an HTML documentation of the Matlab M-files found</span>
0004 <span class="comment">%  in the direct subdirectories of the current directory. HTML files are</span>
0005 <span class="comment">%  written in a 'doc' directory (created if necessary). All the others options</span>
0006 <span class="comment">%  are set to default (in brackets in the following).</span>
0007 <span class="comment">%  M2HTML('PropertyName1',PropertyValue1,'PropertyName2',PropertyValue2,...)</span>
0008 <span class="comment">%  sets multiple option values. The list of option names and default values is:</span>
0009 <span class="comment">%    o mFiles - Cell array of strings or character array containing the</span>
0010 <span class="comment">%       list of M-files and/or directories of M-files for which an HTML</span>
0011 <span class="comment">%       documentation will be built (use relative paths without backtracking).</span>
0012 <span class="comment">%       Launch M2HTML one directory above the directory your wanting to</span>
0013 <span class="comment">%       generate documentation for  [ &lt;all direct subdirectories&gt; ]</span>
0014 <span class="comment">%    o htmlDir - Top level directory for generated HTML files [ 'doc' ]</span>
0015 <span class="comment">%    o recursive - Process subdirectories recursively [ on | {off} ]</span>
0016 <span class="comment">%    o source - Include Matlab source code in the generated documentation</span>
0017 <span class="comment">%                               [ {on} | off ]</span>
0018 <span class="comment">%    o download - Add a link to download each M-file separately [ on | {off} ]</span>
0019 <span class="comment">%    o syntaxHighlighting - Source Code Syntax Highlighting [ {on} | off ]</span>
0020 <span class="comment">%    o tabs - Replace '\t' (horizontal tab) in source code by n white space</span>
0021 <span class="comment">%        characters [ 0 ... {4} ... n ]</span>
0022 <span class="comment">%    o globalHypertextLinks - Hypertext links among separate Matlab</span>
0023 <span class="comment">%        directories [ on | {off} ]</span>
0024 <span class="comment">%    o todo - Create a TODO list in each directory summarizing all the</span>
0025 <span class="comment">%        '% TODO %' lines found in Matlab code [ on | {off}]</span>
0026 <span class="comment">%    o graph - Compute a dependency graph using GraphViz [ on | {off}]</span>
0027 <span class="comment">%        'dot' required, see &lt;http://www.graphviz.org/&gt;</span>
0028 <span class="comment">%    o indexFile - Basename of the HTML index file [ 'index' ]</span>
0029 <span class="comment">%    o extension - Extension of generated HTML files [ '.html' ]</span>
0030 <span class="comment">%    o template - HTML template name to use [ {'blue'} | 'frame' | ... ]</span>
0031 <span class="comment">%    o search - Add a PHP search engine [ on | {off}] - beta version!</span>
0032 <span class="comment">%    o ignoredDir - List of directories to be ignored [ {'.svn','.git','.github','.hg'} ]</span>
0033 <span class="comment">%    o save - Save current state after M-files parsing in 'm2html.mat'</span>
0034 <span class="comment">%        in directory htmlDir [ on | {off}]</span>
0035 <span class="comment">%    o load - Load a previously saved '.mat' M2HTML state to generate HTML</span>
0036 <span class="comment">%        files once again with possibly other options [ &lt;none&gt; ]</span>
0037 <span class="comment">%    o verbose - Verbose mode [ {on} | off ]</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%  For more information, please read the M2HTML tutorial and FAQ at:</span>
0040 <span class="comment">%    &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%  Examples:</span>
0043 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc');</span>
0044 <span class="comment">%    &gt;&gt; m2html('mfiles',{'matlab/signal' 'matlab/image'}, 'htmldir','doc');</span>
0045 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'recursive','on');</span>
0046 <span class="comment">%    &gt;&gt; m2html('mfiles','mytoolbox', 'htmldir','doc', 'source','off');</span>
0047 <span class="comment">%    &gt;&gt; m2html('mfiles','matlab', 'htmldir','doc', 'global','on');</span>
0048 <span class="comment">%    &gt;&gt; m2html( ... , 'template','frame', 'index','menu');</span>
0049 
0050 <span class="comment">%  Copyright (C) 2005 Guillaume Flandin &lt;Guillaume@artefact.tk&gt;</span>
0051 <span class="comment">%  $Revision: 1.5 $Date: 2005/05/01 16:15:30 $</span>
0052 
0053 <span class="comment">%  This program is free software; you can redistribute it and/or</span>
0054 <span class="comment">%  modify it under the terms of the GNU General Public License</span>
0055 <span class="comment">%  as published by the Free Software Foundation; either version 2</span>
0056 <span class="comment">%  of the License, or any later version.</span>
0057 <span class="comment">%</span>
0058 <span class="comment">%  This program is distributed in the hope that it will be useful,</span>
0059 <span class="comment">%  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0060 <span class="comment">%  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0061 <span class="comment">%  GNU General Public License for more details.</span>
0062 <span class="comment">%</span>
0063 <span class="comment">%  You should have received a copy of the GNU General Public License</span>
0064 <span class="comment">%  along with this program; if not, write to the Free Software</span>
0065 <span class="comment">%  Foundation Inc, 59 Temple Pl. - Suite 330, Boston, MA 02111-1307, USA.</span>
0066 
0067 <span class="comment">%  Suggestions for improvement and fixes are always welcome, although no</span>
0068 <span class="comment">%  guarantee is made whether and when they will be implemented.</span>
0069 <span class="comment">%  Send requests to &lt;Guillaume@artefact.tk&gt;</span>
0070 
0071 <span class="comment">%  For tips on how to write Matlab code, see:</span>
0072 <span class="comment">%     * MATLAB Programming Style Guidelines, by R. Johnson:</span>
0073 <span class="comment">%       &lt;http://www.datatool.com/prod02.htm&gt;</span>
0074 <span class="comment">%     * For tips on creating help for your m-files 'type help.m'.</span>
0075 <span class="comment">%     * Matlab documentation on M-file Programming:</span>
0076 <span class="comment">%  &lt;http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/ch_funh8.html&gt;</span>
0077 
0078 <span class="comment">%  This function uses the Template class so that you can fully customize</span>
0079 <span class="comment">%  the output. You can modify .tpl files in templates/blue/ or create new</span>
0080 <span class="comment">%  templates in a new directory.</span>
0081 <span class="comment">%  See the template class documentation for more details.</span>
0082 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/template/&gt;</span>
0083 
0084 <span class="comment">%  Latest information on M2HTML is available on the web through:</span>
0085 <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/&gt;</span>
0086 
0087 <span class="comment">%  Other Matlab to HTML converters available on the web:</span>
0088 <span class="comment">%  1/ mat2html.pl, J.C. Kantor, in Perl, 1995:</span>
0089 <span class="comment">%     &lt;http://fresh.t-systems-sfr.com/unix/src/www/mat2html&gt;</span>
0090 <span class="comment">%  2/ htmltools, B. Alsberg, in Matlab, 1997:</span>
0091 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=175&gt;</span>
0092 <span class="comment">%  3/ mtree2html2001, H. Pohlheim, in Perl, 1996, 2001:</span>
0093 <span class="comment">%     &lt;http://www.pohlheim.com/perl_main.html#matlabdocu&gt;</span>
0094 <span class="comment">%  4/ MatlabCodeColorizer, S. Faridani, in C#, 2005:</span>
0095 <span class="comment">%     &lt;http://www.pitchup.com/matlabcolorizer/&gt;</span>
0096 <span class="comment">%  5/ Highlight, G. Flandin, in Matlab, 2003:</span>
0097 <span class="comment">%     &lt;http://www.artefact.tk/software/matlab/highlight/&gt;</span>
0098 <span class="comment">%  6/ mdoc, P. Brinkmann, in Matlab, 2003:</span>
0099 <span class="comment">%     &lt;http://www.math.uiuc.edu/~brinkman/software/mdoc/&gt;</span>
0100 <span class="comment">%  7/ Ocamaweb, Miriad Technologies, in Ocaml, 2002:</span>
0101 <span class="comment">%     &lt;http://ocamaweb.sourceforge.net/&gt;</span>
0102 <span class="comment">%  8/ Matdoc, M. Kaminsky, in Perl, 2003:</span>
0103 <span class="comment">%     &lt;http://www.mathworks.com/matlabcentral/fileexchange/loadFile.do?objectId=3498&gt;</span>
0104 <span class="comment">%  9/ Matlab itself, The Mathworks Inc, with HELPWIN, DOC and PUBLISH (R14)</span>
0105 
0106 <span class="comment">%--------------------------------------------------------------------------</span>
0107 <span class="comment">%- Set up options and default parameters</span>
0108 <span class="comment">%--------------------------------------------------------------------------</span>
0109 t0 = clock; <span class="comment">% for statistics</span>
0110 msgInvalidPair = <span class="string">'Bad value for argument: ''%s'''</span>;
0111 
0112 options = struct(<span class="string">'verbose'</span>, 1,<span class="keyword">...</span>
0113                  <span class="string">'mFiles'</span>, {{<span class="string">'.'</span>}},<span class="keyword">...</span>
0114                  <span class="string">'htmlDir'</span>, <span class="string">'doc'</span>,<span class="keyword">...</span>
0115                  <span class="string">'recursive'</span>, 0,<span class="keyword">...</span>
0116                  <span class="string">'source'</span>, 1,<span class="keyword">...</span>
0117                  <span class="string">'download'</span>,0,<span class="keyword">...</span>
0118                  <span class="string">'syntaxHighlighting'</span>, 1,<span class="keyword">...</span>
0119                  <span class="string">'tabs'</span>, 4,<span class="keyword">...</span>
0120                  <span class="string">'globalHypertextLinks'</span>, 0,<span class="keyword">...</span>
0121                  <span class="string">'graph'</span>, 0,<span class="keyword">...</span>
0122                  <span class="string">'todo'</span>, 0,<span class="keyword">...</span>
0123                  <span class="string">'load'</span>, 0,<span class="keyword">...</span>
0124                  <span class="string">'save'</span>, 0,<span class="keyword">...</span>
0125                  <span class="string">'search'</span>, 0,<span class="keyword">...</span>
0126                  <span class="string">'helptocxml'</span>, 0,<span class="keyword">...</span>
0127                  <span class="string">'indexFile'</span>, <span class="string">'index'</span>,<span class="keyword">...</span>
0128                  <span class="string">'extension'</span>, <span class="string">'.html'</span>,<span class="keyword">...</span>
0129                  <span class="string">'template'</span>, <span class="string">'blue'</span>,<span class="keyword">...</span>
0130                  <span class="string">'rootdir'</span>, pwd,<span class="keyword">...</span>
0131                  <span class="string">'ignoredDir'</span>, {{<span class="string">'.svn'</span>,<span class="string">'.git'</span>,<span class="string">'.github'</span>,<span class="string">'.hg'</span>}}, <span class="keyword">...</span>
0132                  <span class="string">'language'</span>, <span class="string">'english'</span>);
0133 
0134 <span class="keyword">if</span> nargin == 1 &amp;&amp; isstruct(varargin{1})
0135     paramlist = [ fieldnames(varargin{1}) <span class="keyword">...</span>
0136                   struct2cell(varargin{1}) ]';
0137     paramlist = { paramlist{:} };
0138 <span class="keyword">else</span>
0139     <span class="keyword">if</span> mod(nargin,2)
0140         error(<span class="string">'Invalid parameter/value pair arguments.'</span>);
0141     <span class="keyword">end</span>
0142     paramlist = varargin;
0143 <span class="keyword">end</span>
0144 
0145 optionsnames = lower(fieldnames(options));
0146 <span class="keyword">for</span> i=1:2:length(paramlist)
0147     pname = paramlist{i};
0148     pvalue = paramlist{i+1};
0149     ind = strmatch(lower(pname),optionsnames);
0150     <span class="keyword">if</span> isempty(ind)
0151         error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0152     <span class="keyword">elseif</span> length(ind) &gt; 1
0153         error([<span class="string">'Ambiguous parameter: '''</span> pname <span class="string">'''.'</span>]);
0154     <span class="keyword">end</span>
0155     <span class="keyword">switch</span>(optionsnames{ind})
0156         <span class="keyword">case</span> <span class="string">'verbose'</span>
0157             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0158                 options.verbose = 1;
0159             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0160                 options.verbose = 0;
0161             <span class="keyword">else</span>
0162                 error(sprintf(msgInvalidPair,pname));
0163             <span class="keyword">end</span>
0164         <span class="keyword">case</span> <span class="string">'mfiles'</span>
0165             <span class="keyword">if</span> iscellstr(pvalue)
0166                 options.mFiles = pvalue;
0167             <span class="keyword">elseif</span> ischar(pvalue)
0168                 options.mFiles = cellstr(pvalue);
0169             <span class="keyword">else</span>
0170                 error(sprintf(msgInvalidPair,pname));
0171             <span class="keyword">end</span>
0172             options.load = 0;
0173         <span class="keyword">case</span> <span class="string">'htmldir'</span>
0174             <span class="keyword">if</span> ischar(pvalue)
0175                 <span class="keyword">if</span> isempty(pvalue)
0176                     options.htmlDir = <span class="string">'.'</span>;
0177                 <span class="keyword">else</span>
0178                     options.htmlDir = pvalue;
0179                 <span class="keyword">end</span>
0180             <span class="keyword">else</span>
0181                 error(sprintf(msgInvalidPair,pname));
0182             <span class="keyword">end</span>
0183         <span class="keyword">case</span> <span class="string">'recursive'</span>
0184             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0185                 options.recursive = 1;
0186             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0187                 options.recursive = 0;
0188             <span class="keyword">else</span>
0189                 error(sprintf(msgInvalidPair,pname));
0190             <span class="keyword">end</span>
0191             options.load = 0;
0192         <span class="keyword">case</span> <span class="string">'source'</span>
0193             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0194                 options.source = 1;
0195             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0196                 options.source = 0;
0197             <span class="keyword">else</span>
0198                 error(sprintf(msgInvalidPair,pname));
0199             <span class="keyword">end</span>
0200         <span class="keyword">case</span> <span class="string">'download'</span>
0201             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0202                 options.download = 1;
0203             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0204                 options.download = 0;
0205             <span class="keyword">else</span>
0206                 error(sprintf(msgInvalidPair,pname));
0207             <span class="keyword">end</span>
0208         <span class="keyword">case</span> <span class="string">'syntaxhighlighting'</span>
0209             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0210                 options.syntaxHighlighting = 1;
0211             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0212                 options.syntaxHighlighting = 0;
0213             <span class="keyword">else</span>
0214                 error(sprintf(msgInvalidPair,pname));
0215             <span class="keyword">end</span>
0216         <span class="keyword">case</span> <span class="string">'tabs'</span>
0217             <span class="keyword">if</span> pvalue &gt;= 0
0218                 options.tabs = pvalue;
0219             <span class="keyword">else</span>
0220                 error(sprintf(msgInvalidPair,pname));
0221             <span class="keyword">end</span>
0222         <span class="keyword">case</span> <span class="string">'globalhypertextlinks'</span>
0223             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0224                 options.globalHypertextLinks = 1;
0225             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0226                 options.globalHypertextLinks = 0;
0227             <span class="keyword">else</span>
0228                 error(sprintf(msgInvalidPair,pname));
0229             <span class="keyword">end</span>
0230             options.load = 0;
0231         <span class="keyword">case</span> <span class="string">'graph'</span>
0232             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0233                 options.graph = 1;
0234             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0235                 options.graph = 0;
0236             <span class="keyword">else</span>
0237                 error(sprintf(msgInvalidPair,pname));
0238             <span class="keyword">end</span>
0239         <span class="keyword">case</span> <span class="string">'todo'</span>
0240             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0241                 options.todo = 1;
0242             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0243                 options.todo = 0;
0244             <span class="keyword">else</span>
0245                 error(sprintf(msgInvalidPair,pname));
0246             <span class="keyword">end</span>
0247         <span class="keyword">case</span> <span class="string">'load'</span>
0248             <span class="keyword">if</span> ischar(pvalue)
0249                 <span class="keyword">if</span> exist(pvalue) == 7 <span class="comment">% directory provided</span>
0250                     pvalue = fullfile(pvalue,<span class="string">'m2html.mat'</span>);
0251                 <span class="keyword">end</span>         
0252                 <span class="keyword">try</span>
0253                     load(pvalue);
0254                 <span class="keyword">catch</span>
0255                     error(sprintf(<span class="string">'Unable to load %s.'</span>, pvalue));
0256                 <span class="keyword">end</span>
0257                 options.load = 1;
0258                 [dummy options.template] = fileparts(options.template);
0259             <span class="keyword">else</span>
0260                 error(sprintf(msgInvalidPair,pname));
0261             <span class="keyword">end</span>
0262         <span class="keyword">case</span> <span class="string">'save'</span>
0263             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0264                 options.save = 1;
0265             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0266                 options.save = 0;
0267             <span class="keyword">else</span>
0268                 error(sprintf(msgInvalidPair,pname));
0269             <span class="keyword">end</span>
0270         <span class="keyword">case</span> <span class="string">'search'</span>
0271             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0272                 options.search = 1;
0273             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0274                 options.search = 0;
0275             <span class="keyword">else</span>
0276                 error(sprintf(msgInvalidPair,pname));
0277             <span class="keyword">end</span>
0278         <span class="keyword">case</span> <span class="string">'helptocxml'</span>
0279             <span class="keyword">if</span> strcmpi(pvalue,<span class="string">'on'</span>)
0280                 options.helptocxml = 1;
0281             <span class="keyword">elseif</span> strcmpi(pvalue,<span class="string">'off'</span>)
0282                 options.helptocxml = 0;
0283             <span class="keyword">else</span>
0284                 error(sprintf(msgInvalidPair,pname));
0285             <span class="keyword">end</span>
0286         <span class="keyword">case</span> <span class="string">'indexfile'</span>
0287             <span class="keyword">if</span> ischar(pvalue)
0288                 options.indexFile = pvalue;
0289             <span class="keyword">else</span>
0290                 error(sprintf(msgInvalidPair,pname));
0291             <span class="keyword">end</span>
0292         <span class="keyword">case</span> <span class="string">'extension'</span>
0293             <span class="keyword">if</span> ischar(pvalue) &amp;&amp; pvalue(1) == <span class="string">'.'</span>
0294                 options.extension = pvalue;
0295             <span class="keyword">else</span>
0296                 error(sprintf(msgInvalidPair,pname));
0297             <span class="keyword">end</span>
0298         <span class="keyword">case</span> <span class="string">'template'</span>
0299             <span class="keyword">if</span> ischar(pvalue)
0300                 options.template = pvalue;
0301             <span class="keyword">else</span>
0302                 error(sprintf(msgInvalidPair,pname));
0303             <span class="keyword">end</span>
0304         <span class="keyword">case</span> <span class="string">'ignoreddir'</span>
0305             <span class="keyword">if</span> iscellstr(pvalue)
0306                 options.ignoredDir = pvalue;
0307             <span class="keyword">elseif</span> ischar(pvalue)
0308                 options.ignoredDir = cellstr(pvalue);
0309             <span class="keyword">else</span>
0310                 error(sprintf(msgInvalidPair,pname));
0311             <span class="keyword">end</span>
0312         <span class="keyword">case</span> <span class="string">'language'</span>
0313             <span class="keyword">if</span> ischar(pvalue)
0314                 options.language = pvalue;
0315             <span class="keyword">else</span>
0316                 error(sprintf(msgInvalidPair,pname));
0317             <span class="keyword">end</span>
0318         <span class="keyword">otherwise</span>
0319             error([<span class="string">'Invalid parameter: '''</span> pname <span class="string">'''.'</span>]);
0320     <span class="keyword">end</span>
0321 <span class="keyword">end</span>
0322 
0323 <span class="comment">%--------------------------------------------------------------------------</span>
0324 <span class="comment">%- Get template files location</span>
0325 <span class="comment">%--------------------------------------------------------------------------</span>
0326 s = fileparts(which(mfilename));
0327 options.template = fullfile(s,<span class="string">'templates'</span>,options.template);
0328 <span class="keyword">if</span> exist(options.template) ~= 7
0329     error(<span class="string">'[Template] Unknown template.'</span>);
0330 <span class="keyword">end</span>
0331 
0332 <span class="comment">%--------------------------------------------------------------------------</span>
0333 <span class="comment">%- Get list of M-files</span>
0334 <span class="comment">%--------------------------------------------------------------------------</span>
0335 <span class="keyword">if</span> ~options.load
0336     <span class="keyword">if</span> strcmp(options.mFiles,<span class="string">'.'</span>)
0337         d = dir(pwd); d = {d([d.isdir]).name};
0338         options.mFiles = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0339     <span class="keyword">end</span>
0340     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive,ignoredDir)">getmfiles</a>(options.mFiles,{},options.recursive,options.ignoredDir);
0341     <span class="keyword">if</span> ~length(mfiles), fprintf(<span class="string">'Nothing to be done.\n'</span>); <span class="keyword">return</span>; <span class="keyword">end</span>
0342     <span class="keyword">if</span> options.verbose
0343         fprintf(<span class="string">'Found %d M-files.\n'</span>,length(mfiles));
0344     <span class="keyword">end</span>
0345     mfiles = sort(mfiles); <span class="comment">% sort list of M-files in dictionary order</span>
0346 <span class="keyword">end</span>
0347 
0348 <span class="comment">%--------------------------------------------------------------------------</span>
0349 <span class="comment">%- Get list of (unique) directories and (unique) names</span>
0350 <span class="comment">%--------------------------------------------------------------------------</span>
0351 <span class="keyword">if</span> ~options.load
0352     mdirs = {};
0353     names = {};
0354     <span class="keyword">for</span> i=1:length(mfiles)
0355         [mdirs{i}, names{i}] = fileparts(mfiles{i});
0356         <span class="keyword">if</span> isempty(mdirs{i}), mdirs{i} = <span class="string">'.'</span>; <span class="keyword">end</span>
0357     <span class="keyword">end</span>
0358 
0359     mdir = unique(mdirs);
0360     <span class="keyword">if</span> options.verbose
0361         fprintf(<span class="string">'Found %d unique Matlab directories.\n'</span>,length(mdir));
0362     <span class="keyword">end</span>
0363 
0364     name = names;
0365     <span class="comment">%name = unique(names); % output is sorted</span>
0366     <span class="comment">%if options.verbose,</span>
0367     <span class="comment">%    fprintf('Found %d unique Matlab files.\n',length(name));</span>
0368     <span class="comment">%end</span>
0369 <span class="keyword">end</span>
0370 
0371 <span class="comment">%--------------------------------------------------------------------------</span>
0372 <span class="comment">%- Create output directory, if necessary</span>
0373 <span class="comment">%--------------------------------------------------------------------------</span>
0374 <span class="keyword">if</span> isempty(dir(options.htmlDir))                                               
0375     <span class="comment">%- Create the top level output directory</span>
0376     <span class="keyword">if</span> options.verbose                                                         
0377         fprintf(<span class="string">'Creating directory %s...\n'</span>,options.htmlDir);                 
0378     <span class="keyword">end</span>                                                                        
0379     <span class="keyword">if</span> options.htmlDir(end) == filesep                                       
0380         options.htmlDir(end) = [];                                             
0381     <span class="keyword">end</span>                                                                        
0382     [pathdir, namedir] = fileparts(options.htmlDir);                           
0383     <span class="keyword">if</span> isempty(pathdir)                                                        
0384         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                                        
0385     <span class="keyword">else</span>                                                                       
0386         [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(pathdir), <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(namedir));                               
0387     <span class="keyword">end</span>                                                                        
0388     <span class="keyword">if</span> ~status, error(msg); <span class="keyword">end</span>                                                                
0389 <span class="keyword">end</span>                                                                            
0390 
0391 <span class="comment">%--------------------------------------------------------------------------</span>
0392 <span class="comment">%- Get synopsis, H1 line, script/function, subroutines, cross-references, todo</span>
0393 <span class="comment">%--------------------------------------------------------------------------</span>
0394 <span class="keyword">if</span> ~options.load
0395     synopsis   = cell(size(mfiles));
0396     h1line     = cell(size(mfiles));
0397     subroutine = cell(size(mfiles));
0398     hrefs      = sparse(length(mfiles), length(mfiles));
0399     todo       = struct(<span class="string">'mfile'</span>,[], <span class="string">'line'</span>,[], <span class="string">'comment'</span>,{{}});
0400     ismex      = zeros(length(mfiles), numel(<a href="../m2html/private/mexexts.html" class="code" title="function ext = mexexts">mexexts</a>));
0401     statlist   = {};
0402     statinfo   = sparse(1,length(mfiles));
0403     kw         = cell(size(mfiles));
0404     freq       = cell(size(mfiles));
0405 
0406     <span class="keyword">for</span> i=1:length(mfiles)
0407         <span class="keyword">if</span> options.verbose
0408             fprintf(<span class="string">'Processing file %s...'</span>,mfiles{i});
0409         <span class="keyword">end</span>
0410         s = <a href="../m2html/private/mfileparse.html" class="code" title="function s = mfileparse(mfile, mdirs, names, options)">mfileparse</a>(mfiles{i}, mdirs, names, options);
0411         synopsis{i}   = s.synopsis;
0412         h1line{i}     = s.h1line;
0413         subroutine{i} = s.subroutine;
0414         hrefs(i,:)    = s.hrefs;
0415         todo.mfile    = [todo.mfile repmat(i,1,length(s.todo.line))];
0416         todo.line     = [todo.line s.todo.line];
0417         todo.comment  = {todo.comment{:} s.todo.comment{:}};
0418         ismex(i,:)    = s.ismex;
0419         <span class="keyword">if</span> options.search
0420             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'search...'</span>); <span class="keyword">end</span>
0421             [kw{i}, freq{i}] = <a href="../m2html/private/searchindex.html" class="code" title="function [s, freq] = searchindex(mfile, szmin)">searchindex</a>(mfiles{i});
0422             statlist = union(statlist, kw{i});
0423         <span class="keyword">end</span>
0424         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0425     <span class="keyword">end</span>
0426     hrefs = hrefs &gt; 0;
0427     <span class="keyword">if</span> options.search
0428         <span class="keyword">if</span> options.verbose
0429             fprintf(<span class="string">'Creating the search index...'</span>);
0430         <span class="keyword">end</span>
0431         statinfo = sparse(length(statlist),length(mfiles));
0432         <span class="keyword">for</span> i=1:length(mfiles)
0433             i1 = find(ismember(statlist, kw{i}));
0434             i2 = repmat(i,1,length(i1));
0435             <span class="keyword">if</span> ~isempty(i1)
0436                 statinfo(sub2ind(size(statinfo),i1,i2)) = freq{i};
0437             <span class="keyword">end</span>
0438             <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'.'</span>); <span class="keyword">end</span>
0439         <span class="keyword">end</span>
0440         clear kw freq;
0441         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0442     <span class="keyword">end</span>
0443 <span class="keyword">end</span>
0444 
0445 <span class="comment">%--------------------------------------------------------------------------</span>
0446 <span class="comment">%- Save M-filenames and cross-references for further analysis</span>
0447 <span class="comment">%--------------------------------------------------------------------------</span>
0448 matfilesave = <span class="string">'m2html.mat'</span>;
0449 
0450 <span class="keyword">if</span> options.save
0451     <span class="keyword">if</span> options.verbose
0452         fprintf(<span class="string">'Saving MAT file %s...\n'</span>,matfilesave);
0453     <span class="keyword">end</span>
0454     save(fullfile(options.htmlDir,matfilesave), <span class="keyword">...</span>
0455         <span class="string">'mfiles'</span>, <span class="string">'names'</span>, <span class="string">'mdirs'</span>, <span class="string">'name'</span>, <span class="string">'mdir'</span>, <span class="string">'options'</span>, <span class="keyword">...</span>
0456         <span class="string">'hrefs'</span>, <span class="string">'synopsis'</span>, <span class="string">'h1line'</span>, <span class="string">'subroutine'</span>, <span class="string">'todo'</span>, <span class="string">'ismex'</span>, <span class="keyword">...</span>
0457         <span class="string">'statlist'</span>, <span class="string">'statinfo'</span>);
0458 <span class="keyword">end</span>
0459 
0460 <span class="comment">%--------------------------------------------------------------------------</span>
0461 <span class="comment">%- Setup the output directories</span>
0462 <span class="comment">%--------------------------------------------------------------------------</span>
0463 <span class="keyword">for</span> i=1:length(mdir)
0464     <span class="keyword">if</span> exist(fullfile(options.htmlDir,mdir{i})) ~= 7
0465         ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
0466         <span class="keyword">for</span> j=1:length(ldir)
0467             <span class="keyword">if</span> exist(fullfile(options.htmlDir,ldir{1:j})) ~= 7
0468                 <span class="comment">%- Create the output directory</span>
0469                 <span class="keyword">if</span> options.verbose
0470                     fprintf(<span class="string">'Creating directory %s...\n'</span>,<span class="keyword">...</span>
0471                             fullfile(options.htmlDir,ldir{1:j}));
0472                 <span class="keyword">end</span>
0473                 <span class="keyword">if</span> j == 1
0474                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0475                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(ldir{1}));
0476                 <span class="keyword">else</span>
0477                     [status, msg] = mkdir(<a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(options.htmlDir), <span class="keyword">...</span>
0478                         <a href="#_sub7" class="code" title="subfunction str = escapeblank(str)">escapeblank</a>(fullfile(ldir{1:j})));
0479                 <span class="keyword">end</span>
0480                 error(msg);
0481             <span class="keyword">end</span>
0482         <span class="keyword">end</span>
0483     <span class="keyword">end</span>
0484 <span class="keyword">end</span>
0485 
0486 <span class="comment">%--------------------------------------------------------------------------</span>
0487 <span class="comment">%- Write the master index file</span>
0488 <span class="comment">%--------------------------------------------------------------------------</span>
0489 tpl_master = <span class="string">'master.tpl'</span>;
0490 tpl_master_identifier_nbyline = 4;
0491 php_search = <span class="string">'search.php'</span>;
0492 dotbase = <span class="string">'graph'</span>;
0493 
0494 <span class="comment">%- Create the HTML template</span>
0495 tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0496 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MASTER'</span>,tpl_master);
0497 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'rowdir'</span>,<span class="string">'rowdirs'</span>);
0498 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'idrow'</span>,<span class="string">'idrows'</span>);
0499 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'idrow'</span>,<span class="string">'idcolumn'</span>,<span class="string">'idcolumns'</span>);
0500 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'search'</span>,<span class="string">'searchs'</span>);
0501 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MASTER'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0502 
0503 <span class="comment">%- Open for writing the HTML master index file</span>
0504 curfile = fullfile(options.htmlDir,[options.indexFile options.extension]);
0505 <span class="keyword">if</span> options.verbose
0506     fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0507 <span class="keyword">end</span>
0508 fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0509 
0510 <span class="comment">%- Set some template variables</span>
0511 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0512                             datestr(now,13)]);
0513 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0514 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DIRS'</span>, sprintf(<span class="string">'%s '</span>,mdir{:}));
0515 
0516 <span class="comment">%- Print list of unique directories</span>
0517 <span class="keyword">for</span> i=1:length(mdir)
0518     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_DIR'</span>,<span class="keyword">...</span>
0519               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdir{i},[options.indexFile options.extension]));
0520     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DIR'</span>,mdir{i});
0521     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rowdirs'</span>,<span class="string">'rowdir'</span>,1);
0522 <span class="keyword">end</span>
0523 
0524 <span class="comment">%- Print full list of M-files (sorted by column)</span>
0525 [sortnames, ind] = sort(names);
0526 m_mod = mod(length(sortnames), tpl_master_identifier_nbyline);
0527 ind = [ind zeros(1,tpl_master_identifier_nbyline-m_mod)];
0528 m_floor = floor(length(ind) / tpl_master_identifier_nbyline);
0529 ind = reshape(ind,m_floor,tpl_master_identifier_nbyline)';
0530 
0531 <span class="keyword">for</span> i=1:prod(size(ind))
0532     <span class="keyword">if</span> ind(i)
0533         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="keyword">...</span>
0534             <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{ind(i)},[names{ind(i)} options.extension]));
0535         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,mdirs{ind(i)});
0536         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,names{ind(i)});
0537         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0538     <span class="keyword">else</span>
0539         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_IDNAME'</span>,<span class="string">''</span>);
0540         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'T_IDNAME'</span>,<span class="string">''</span>);
0541         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDNAME'</span>,<span class="string">''</span>);
0542         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idcolumns'</span>,<span class="string">'idcolumn'</span>,1);
0543     <span class="keyword">end</span>
0544     <span class="keyword">if</span> mod(i,tpl_master_identifier_nbyline) == 0
0545         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'idrows'</span>,<span class="string">'idrow'</span>,1);
0546         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'idcolumns'</span>,<span class="string">''</span>);
0547     <span class="keyword">end</span>
0548 <span class="keyword">end</span>
0549 
0550 <span class="comment">%- Add a search form if necessary</span>
0551 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'searchs'</span>,<span class="string">''</span>);
0552 <span class="keyword">if</span> options.search
0553     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0554     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'searchs'</span>,<span class="string">'search'</span>,1);
0555 <span class="keyword">end</span>
0556 
0557 <span class="comment">%- Link to a full dependency graph, if necessary</span>
0558 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0559 <span class="keyword">if</span> options.graph &amp;&amp; options.globalHypertextLinks &amp;&amp; length(mdir) &gt; 1
0560     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0561     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0562 <span class="keyword">end</span>
0563 
0564 <span class="comment">%- Print the template in the HTML file</span>
0565 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MASTER'</span>);
0566 fprintf(fid,<span class="string">'%s'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0567 fclose(fid);
0568 
0569 <span class="comment">%--------------------------------------------------------------------------</span>
0570 <span class="comment">%- Copy template files (CSS, images, ...)</span>
0571 <span class="comment">%--------------------------------------------------------------------------</span>
0572 <span class="comment">% Get list of files</span>
0573 d = dir(options.template);
0574 d = {d(~[d.isdir]).name};
0575 <span class="comment">% Copy files</span>
0576 <span class="keyword">for</span> i=1:length(d)
0577     [p, n, ext] = fileparts(d{i});
0578     <span class="keyword">if</span> ~strcmp(ext,<span class="string">'.tpl'</span>) <span class="keyword">...</span><span class="comment"> % do not copy .tpl files</span>
0579        &amp;&amp; ~strcmp([n ext],<span class="string">'Thumbs.db'</span>) <span class="comment">% do not copy this Windows generated file</span>
0580         <span class="keyword">if</span> isempty(dir(fullfile(options.htmlDir,d{i})))
0581             <span class="keyword">if</span> options.verbose
0582                 fprintf(<span class="string">'Copying template file %s...\n'</span>,d{i});
0583             <span class="keyword">end</span>
0584             <span class="comment">%- there is a bug with &lt;copyfile&gt; in Matlab 6.5 :</span>
0585             <span class="comment">%   http://www.mathworks.com/support/solutions/data/1-1B5JY.html</span>
0586             <span class="comment">%- and &lt;copyfile&gt; does not overwrite files even if newer...</span>
0587             [status, errmsg] = copyfile(fullfile(options.template,d{i}),<span class="keyword">...</span>
0588                                         options.htmlDir);
0589             <span class="comment">%- If you encounter this bug, please uncomment one of the following lines</span>
0590             <span class="comment">% eval(['!cp -rf ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0591             <span class="comment">% eval(['!copy ' fullfile(options.template,d{i}) ' ' options.htmlDir]);</span>
0592             <span class="comment">% status = 1;</span>
0593             <span class="keyword">if</span> ~status
0594                 <span class="keyword">if</span> ~isempty(errmsg)
0595                     error(errmsg)
0596                 <span class="keyword">else</span>
0597                     warning(sprintf([<span class="string">'&lt;copyfile&gt; failed to do its job...\n'</span> <span class="keyword">...</span>
0598                 <span class="string">'This is a known bug in Matlab 6.5 (R13).\n'</span> <span class="keyword">...</span>
0599                 <span class="string">'See http://www.mathworks.com/support/solutions/data/1-1B5JY.html'</span>]));
0600                 <span class="keyword">end</span>
0601             <span class="keyword">end</span>
0602         <span class="keyword">end</span>
0603     <span class="keyword">end</span>
0604 <span class="keyword">end</span>
0605 
0606 <span class="comment">%--------------------------------------------------------------------------</span>
0607 <span class="comment">%- Search engine (index file and PHP script)</span>
0608 <span class="comment">%--------------------------------------------------------------------------</span>
0609 tpl_search = <span class="string">'search.tpl'</span>;
0610 idx_search = <span class="string">'search.idx'</span>;
0611 
0612 <span class="comment">% TODO % improving the fill in of 'statlist' and 'statinfo'</span>
0613 <span class="comment">% TODO % improving the search template file and update the CSS file</span>
0614 
0615 <span class="keyword">if</span> options.search
0616     <span class="comment">%- Write the search index file in output directory</span>
0617     <span class="keyword">if</span> options.verbose
0618         fprintf(<span class="string">'Creating Search Index file %s...\n'</span>, idx_search);
0619     <span class="keyword">end</span>
0620     docinfo = cell(length(mfiles),2);
0621     <span class="keyword">for</span> i=1:length(mfiles)
0622         docinfo{i,1} = h1line{i};
0623         docinfo{i,2} = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(mdirs{i}, [names{i} options.extension]);
0624     <span class="keyword">end</span>
0625     <a href="../m2html/private/doxywrite.html" class="code" title="function doxywrite(filename, kw, statinfo, docinfo)">doxywrite</a>(fullfile(options.htmlDir,idx_search),statlist,statinfo,docinfo);
0626     
0627     <span class="comment">%- Create the PHP template</span>
0628     tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0629     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_SEARCH'</span>,tpl_search);
0630     
0631     <span class="comment">%- Open for writing the PHP search script</span>
0632     curfile = fullfile(options.htmlDir, php_search); 
0633     <span class="keyword">if</span> options.verbose
0634         fprintf(<span class="string">'Creating PHP script %s...\n'</span>,curfile);
0635     <span class="keyword">end</span>
0636     fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0637     
0638     <span class="comment">%- Set template fields</span>
0639     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0640     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<span class="string">'./'</span>);
0641     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0642                                 datestr(now,13)]);
0643     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'IDXFILE'</span>,idx_search);
0644     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PHPFILE'</span>,php_search);
0645     
0646     <span class="comment">%- Print the template in the HTML file</span>
0647     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_SEARCH'</span>);
0648     fprintf(fid,<span class="string">'%s'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0649     fclose(fid);
0650 <span class="keyword">end</span>
0651 
0652 <span class="comment">%--------------------------------------------------------------------------</span>
0653 <span class="comment">%- Create &lt;helptoc.xml&gt; needed to display hierarchical entries in Contents panel</span>
0654 <span class="comment">%--------------------------------------------------------------------------</span>
0655 <span class="comment">% See http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_env/guiref16.html</span>
0656 <span class="comment">% and http://www.mathworks.com/support/solutions/data/1-18U6Q.html?solution=1-18U6Q</span>
0657 
0658 <span class="comment">% TODO % display directories in TOC hierarchically instead of linearly</span>
0659 <span class="keyword">if</span> options.helptocxml
0660     curfile = fullfile(options.htmlDir, <span class="string">'helptoc.xml'</span>);
0661     <span class="keyword">if</span> options.verbose
0662         fprintf(<span class="string">'Creating XML Table-Of-Content %s...\n'</span>,curfile);
0663     <span class="keyword">end</span>
0664     fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0665     fprintf(fid,<span class="string">'&lt;?xml version=''1.0'' encoding=''ISO-8859-1'' ?&gt;\n'</span>);
0666     fprintf(fid,<span class="string">'&lt;!-- $Date: %s $ --&gt;\n\n'</span>, datestr(now,31));
0667     fprintf(fid,<span class="string">'&lt;toc version=&quot;1.0&quot;&gt;\n\n'</span>);
0668     fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0669         <span class="string">'image=&quot;$toolbox/matlab/icons/book_mat.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0670         [options.indexFile options.extension],<span class="string">'Toolbox'</span>);
0671     <span class="keyword">for</span> i=1:length(mdir)
0672         fprintf(fid,[<span class="string">'&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0673             <span class="string">'image=&quot;$toolbox/matlab/icons/reficon.gif&quot;&gt;%s\n'</span>], <span class="keyword">...</span>
0674             fullfile(mdir{i}, <span class="keyword">...</span>
0675                 [options.indexFile options.extension]),mdir{i});
0676         <span class="keyword">if</span> options.graph
0677             fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0678             <span class="string">'image=&quot;$toolbox/matlab/icons/simulinkicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0679                 fullfile(mdir{i},<span class="keyword">...</span>
0680                 [dotbase options.extension]),<span class="string">'Dependency Graph'</span>);
0681         <span class="keyword">end</span>
0682         <span class="keyword">if</span> options.todo
0683             <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0684                 fprintf(fid,[<span class="string">'\t&lt;tocitem target=&quot;%s&quot; '</span>,<span class="keyword">...</span>
0685                 <span class="string">'image=&quot;$toolbox/matlab/icons/demoicon.gif&quot;&gt;%s&lt;/tocitem&gt;\n'</span>], <span class="keyword">...</span>
0686                     fullfile(mdir{i},<span class="keyword">...</span>
0687                     [<span class="string">'todo'</span> options.extension]),<span class="string">'Todo list'</span>);
0688             <span class="keyword">end</span>
0689         <span class="keyword">end</span>
0690         <span class="keyword">for</span> j=1:length(mdirs)
0691             <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0692                 curfile = fullfile(mdir{i},<span class="keyword">...</span>
0693                     [names{j} options.extension]);
0694                 fprintf(fid,<span class="string">'\t&lt;tocitem target=&quot;%s&quot;&gt;%s&lt;/tocitem&gt;\n'</span>, <span class="keyword">...</span>
0695                     curfile,names{j});
0696             <span class="keyword">end</span>
0697         <span class="keyword">end</span>
0698         fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0699     <span class="keyword">end</span>
0700     fprintf(fid,<span class="string">'&lt;/tocitem&gt;\n'</span>);
0701     fprintf(fid,<span class="string">'\n&lt;/toc&gt;\n'</span>);
0702     fclose(fid);
0703 <span class="keyword">end</span>
0704 
0705 <span class="comment">%--------------------------------------------------------------------------</span>
0706 <span class="comment">%- Write an index for each output directory</span>
0707 <span class="comment">%--------------------------------------------------------------------------</span>
0708 tpl_mdir = <span class="string">'mdir.tpl'</span>;
0709 tpl_mdir_link = <span class="string">'&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0710 <span class="comment">%dotbase defined earlier</span>
0711 
0712 <span class="comment">%- Create the HTML template</span>
0713 tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0714 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MDIR'</span>,tpl_mdir);
0715 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'row-m'</span>,<span class="string">'rows-m'</span>);
0716 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'row-m'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0717 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'othermatlab'</span>,<span class="string">'other'</span>);
0718 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'othermatlab'</span>,<span class="string">'row-other'</span>,<span class="string">'rows-other'</span>);
0719 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'subfolder'</span>,<span class="string">'subfold'</span>);
0720 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'subfolder'</span>,<span class="string">'subdir'</span>,<span class="string">'subdirs'</span>);
0721 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'todolist'</span>,<span class="string">'todolists'</span>);
0722 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MDIR'</span>,<span class="string">'graph'</span>,<span class="string">'graphs'</span>);
0723 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0724                             datestr(now,13)]);
0725 
0726 <span class="keyword">for</span> i=1:length(mdir)
0727     <span class="comment">%- Open for writing each output directory index file</span>
0728     curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0729                        [options.indexFile options.extension]);
0730     <span class="keyword">if</span> options.verbose
0731         fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0732     <span class="keyword">end</span>
0733     fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0734 
0735     <span class="comment">%- Set template fields</span>
0736     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,     [options.indexFile options.extension]);
0737     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0738     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,      mdir{i});
0739     
0740     <span class="comment">%- Display Matlab m-files, their H1 line and their Mex status</span>
0741     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows-m'</span>,<span class="string">''</span>);
0742     <span class="keyword">for</span> j=1:length(mdirs)
0743         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0744             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME'</span>, [names{j} options.extension]);
0745             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,   names{j});
0746             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>, h1line{j});
0747             <span class="keyword">if</span> any(ismex(j,:))
0748                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
0749             <span class="keyword">else</span>
0750                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>,<span class="string">''</span>);
0751             <span class="keyword">end</span>
0752             tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows-m'</span>,<span class="string">'row-m'</span>,1);
0753         <span class="keyword">end</span>
0754     <span class="keyword">end</span>
0755     
0756     <span class="comment">%- Display other Matlab-specific files (.mat,.mdl,.p)</span>
0757     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'other'</span>,<span class="string">''</span>);
0758     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows-other'</span>,<span class="string">''</span>);
0759     w = what(mdir{i}); w = w(1);
0760     w = {w.mat{:} w.mdl{:} w.p{:}};
0761     <span class="keyword">for</span> j=1:length(w)
0762         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'OTHERFILE'</span>,w{j});
0763         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows-other'</span>,<span class="string">'row-other'</span>,1);
0764     <span class="keyword">end</span>
0765     <span class="keyword">if</span> ~isempty(w)
0766         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'other'</span>,<span class="string">'othermatlab'</span>);
0767     <span class="keyword">end</span>
0768     
0769     <span class="comment">%- Display subsequent directories and classes</span>
0770     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'subdirs'</span>,<span class="string">''</span>);
0771     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'subfold'</span>,<span class="string">''</span>);
0772     d = dir(mdir{i});
0773     d = {d([d.isdir]).name};
0774     d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> options.ignoredDir{:}})}};
0775     <span class="keyword">for</span> j=1:length(d)
0776         <span class="keyword">if</span> ismember(fullfile(mdir{i},d{j}),mdir)
0777             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,<span class="keyword">...</span>
0778                 sprintf(tpl_mdir_link,<span class="keyword">...</span>
0779                 <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(d{j},[options.indexFile options.extension]),d{j}));
0780         <span class="keyword">else</span>
0781             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SUBDIRECTORY'</span>,d{j});
0782         <span class="keyword">end</span>
0783         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subdirs'</span>,<span class="string">'subdir'</span>,1);
0784     <span class="keyword">end</span>
0785     <span class="keyword">if</span> ~isempty(d)
0786         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subfold'</span>,<span class="string">'subfolder'</span>);
0787     <span class="keyword">end</span>
0788     
0789     <span class="comment">%- Link to the TODO list if necessary</span>
0790     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'todolists'</span>,<span class="string">''</span>);
0791     <span class="keyword">if</span> options.todo
0792         <span class="keyword">if</span> ~isempty(intersect(find(strcmp(mdir{i},mdirs)),todo.mfile))
0793             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LTODOLIST'</span>,[<span class="string">'todo'</span> options.extension]);
0794             tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'todolists'</span>,<span class="string">'todolist'</span>,1);
0795         <span class="keyword">end</span>
0796     <span class="keyword">end</span>
0797     
0798     <span class="comment">%- Link to the dependency graph if necessary</span>
0799     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'graphs'</span>,<span class="string">''</span>);
0800     <span class="keyword">if</span> options.graph
0801         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LGRAPH'</span>,[dotbase options.extension]);
0802         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'graphs'</span>,<span class="string">'graph'</span>,1);
0803     <span class="keyword">end</span>
0804     
0805     <span class="comment">%- Print the template in the HTML file</span>
0806     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MDIR'</span>);
0807     fprintf(fid,<span class="string">'%s'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0808     fclose(fid);
0809 <span class="keyword">end</span>
0810 
0811 <span class="comment">%--------------------------------------------------------------------------</span>
0812 <span class="comment">%- Write a TODO list file for each output directory, if necessary</span>
0813 <span class="comment">%--------------------------------------------------------------------------</span>
0814 tpl_todo = <span class="string">'todo.tpl'</span>;
0815 
0816 <span class="keyword">if</span> options.todo
0817     <span class="comment">%- Create the HTML template</span>
0818     tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0819     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_TODO'</span>,tpl_todo);
0820     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_TODO'</span>,<span class="string">'filelist'</span>,<span class="string">'filelists'</span>);
0821     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'filelist'</span>,<span class="string">'row'</span>,<span class="string">'rows'</span>);
0822     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0823                                 datestr(now,13)]);
0824 
0825     <span class="keyword">for</span> i=1:length(mdir)
0826         mfilestodo = intersect(find(strcmp(mdir{i},mdirs)),todo.mfile);
0827         <span class="keyword">if</span> ~isempty(mfilestodo)
0828             <span class="comment">%- Open for writing each TODO list file</span>
0829             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0830                                [<span class="string">'todo'</span> options.extension]);
0831             <span class="keyword">if</span> options.verbose
0832                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0833             <span class="keyword">end</span>
0834             fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
0835             
0836             <span class="comment">%- Set template fields</span>
0837             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0838             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0839             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0840             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'filelists'</span>,  <span class="string">''</span>);
0841     
0842             <span class="keyword">for</span> k=1:length(mfilestodo)
0843                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MFILE'</span>,names{mfilestodo(k)});
0844                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'rows'</span>,<span class="string">''</span>);
0845                 nbtodo = find(todo.mfile == mfilestodo(k));
0846                 <span class="keyword">for</span> l=1:length(nbtodo)
0847                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NBLINE'</span>,<span class="keyword">...</span>
0848                         [names{mfilestodo(k)} <span class="keyword">...</span>
0849                             options.extension <span class="keyword">...</span>
0850                             <span class="string">'#l'</span> num2str(todo.line(nbtodo(l)))]);
0851                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NBLINE'</span>,num2str(todo.line(nbtodo(l))));
0852                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'COMMENT'</span>,todo.comment{nbtodo(l)});
0853                     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'rows'</span>,<span class="string">'row'</span>,1);
0854                 <span class="keyword">end</span>
0855                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'filelists'</span>,<span class="string">'filelist'</span>,1);
0856             <span class="keyword">end</span>
0857     
0858             <span class="comment">%- Print the template in the HTML file</span>
0859             tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_TODO'</span>);
0860             fprintf(fid,<span class="string">'%s'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0861             fclose(fid);
0862         <span class="keyword">end</span>
0863     <span class="keyword">end</span>
0864 <span class="keyword">end</span>
0865 
0866 <span class="comment">%--------------------------------------------------------------------------</span>
0867 <span class="comment">%- Create dependency graphs using GraphViz, if requested</span>
0868 <span class="comment">%--------------------------------------------------------------------------</span>
0869 tpl_graph = <span class="string">'graph.tpl'</span>;
0870 <span class="comment">% You may have to modify the following line with Matlab7 (R14) to specify</span>
0871 <span class="comment">% the full path to where GraphViz is installed</span>
0872 dot_exec  = <span class="string">'dot'</span>;
0873 <span class="comment">%dotbase defined earlier</span>
0874 
0875 <span class="keyword">if</span> options.graph
0876     <span class="comment">%- Create the HTML template</span>
0877     tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0878     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_GRAPH'</span>,tpl_graph);
0879     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0880                                 datestr(now,13)]);
0881     
0882     <span class="comment">%- Create a full dependency graph for all directories if possible</span>
0883     <span class="keyword">if</span> options.globalHypertextLinks &amp;&amp; length(mdir) &gt; 1
0884         mdotfile = fullfile(options.htmlDir,[dotbase <span class="string">'.dot'</span>]);
0885         <span class="keyword">if</span> options.verbose
0886             fprintf(<span class="string">'Creating full dependency graph %s...'</span>,mdotfile);
0887         <span class="keyword">end</span>
0888         <a href="../m2html/private/mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({hrefs, names, options, mdirs}, mdotfile); <span class="comment">%mfiles</span>
0889         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0890                 fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0891                 fullfile(options.htmlDir,[dotbase <span class="string">'.png'</span>]));
0892         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0893         fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir, [dotbase options.extension]),<span class="string">'w'</span>);
0894         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0895         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <span class="string">'./'</span>);
0896         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       <span class="string">'the whole toolbox'</span>);
0897         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0898         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed...</span>
0899             fmap = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0900             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0901             fclose(fmap);
0902         <span class="keyword">end</span>
0903         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0904         fprintf(fid,<span class="string">'%s'</span>, <a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0905         fclose(fid);
0906     <span class="keyword">end</span>
0907     
0908     <span class="comment">%- Create a dependency graph for each output directory</span>
0909     <span class="keyword">for</span> i=1:length(mdir)
0910         mdotfile = fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.dot'</span>]);
0911         <span class="keyword">if</span> options.verbose
0912             fprintf(<span class="string">'Creating dependency graph %s...'</span>,mdotfile);
0913         <span class="keyword">end</span>
0914         ind = find(strcmp(mdirs,mdir{i}));
0915         href1 = zeros(length(ind),length(hrefs));
0916         <span class="keyword">for</span> j=1:length(hrefs), href1(:,j) = hrefs(ind,j); <span class="keyword">end</span>
0917         href2 = zeros(length(ind));
0918         <span class="keyword">for</span> j=1:length(ind), href2(j,:) = href1(j,ind); <span class="keyword">end</span>
0919         <a href="../m2html/private/mdot.html" class="code" title="function mdot(mmat, dotfile,f)">mdot</a>({href2, {names{ind}}, options}, mdotfile); <span class="comment">%{mfiles{ind}}</span>
0920         <a href="#_sub2" class="code" title="subfunction calldot(dotexec, mdotfile, mapfile, pngfile, opt)">calldot</a>(dot_exec, mdotfile, <span class="keyword">...</span>
0921                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]), <span class="keyword">...</span>
0922                 fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.png'</span>]));
0923         <span class="keyword">if</span> options.verbose, fprintf(<span class="string">'\n'</span>); <span class="keyword">end</span>
0924         fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0925             [dotbase options.extension]),<span class="string">'w'</span>);
0926         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>,[options.indexFile options.extension]);
0927         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>, <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
0928         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,       mdir{i});
0929         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_IMG'</span>,  [dotbase <span class="string">'.png'</span>]);
0930         <span class="keyword">try</span> <span class="comment">% if &lt;dot&gt; failed, no '.map' file has been created</span>
0931             fmap = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(fullfile(options.htmlDir,mdir{i},[dotbase <span class="string">'.map'</span>]),<span class="string">'r'</span>);
0932             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'GRAPH_MAP'</span>,  fscanf(fmap,<span class="string">'%c'</span>));
0933             fclose(fmap);
0934         <span class="keyword">end</span>
0935         tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_GRAPH'</span>);
0936         fprintf(fid,<span class="string">'%s'</span>, <a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
0937         fclose(fid);
0938     <span class="keyword">end</span>
0939 <span class="keyword">end</span>
0940 
0941 <span class="comment">%--------------------------------------------------------------------------</span>
0942 <span class="comment">%- Write an HTML file for each M-file</span>
0943 <span class="comment">%--------------------------------------------------------------------------</span>
0944 <span class="comment">%- List of Matlab keywords (output from iskeyword)</span>
0945 matlabKeywords = {<span class="string">'break'</span>, <span class="string">'case'</span>, <span class="string">'catch'</span>, <span class="string">'continue'</span>, <span class="string">'elseif'</span>, <span class="string">'else'</span>, <span class="keyword">...</span>
0946                   <span class="string">'end'</span>, <span class="string">'for'</span>, <span class="string">'function'</span>, <span class="string">'global'</span>, <span class="string">'if'</span>, <span class="string">'otherwise'</span>, <span class="keyword">...</span>
0947                   <span class="string">'persistent'</span>, <span class="string">'return'</span>, <span class="string">'switch'</span>, <span class="string">'try'</span>, <span class="string">'while'</span>};
0948                   <span class="comment">%'keyboard', 'pause', 'eps', 'NaN', 'Inf'</span>
0949 
0950 tpl_mfile = <span class="string">'mfile.tpl'</span>;
0951 
0952 tpl_mfile_code     = <span class="string">'&lt;a href=&quot;%s&quot; class=&quot;code&quot; title=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span>;
0953 tpl_mfile_keyword  = <span class="string">'&lt;span class=&quot;keyword&quot;&gt;%s&lt;/span&gt;'</span>;
0954 tpl_mfile_comment  = <span class="string">'&lt;span class=&quot;comment&quot;&gt;%s&lt;/span&gt;'</span>;
0955 tpl_mfile_string   = <span class="string">'&lt;span class=&quot;string&quot;&gt;%s&lt;/span&gt;'</span>;
0956 tpl_mfile_aname    = <span class="string">'&lt;a name=&quot;%s&quot; href=&quot;#_subfunctions&quot; class=&quot;code&quot;&gt;%s&lt;/a&gt;'</span>;
0957 tpl_mfile_line     = <span class="string">'%04d %s\n'</span>;
0958 
0959 <span class="comment">%- Delimiters used in strtok: some of them may be useless (% &quot; .), removed '.'</span>
0960 strtok_delim = sprintf(<span class="string">' \t\n\r(){}[]&lt;&gt;+-*~!|\\@&amp;/,:;=&quot;''%%'</span>);
0961 
0962 <span class="comment">%- Create the HTML template</span>
0963 tpl = <a href="../m2html/@template/template.html" class="code" title="function tpl = template(root,unknowns)">template</a>(options.template,<span class="string">'remove'</span>);
0964 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'file'</span>,<span class="string">'TPL_MFILE'</span>,tpl_mfile);
0965 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'pathline'</span>,<span class="string">'pl'</span>);
0966 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'mexfile'</span>,<span class="string">'mex'</span>);
0967 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'script'</span>,<span class="string">'scriptfile'</span>);
0968 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcall'</span>,<span class="string">'crossrefcalls'</span>);
0969 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'crossrefcalled'</span>,<span class="string">'crossrefcalleds'</span>);
0970 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'subfunction'</span>,<span class="string">'subf'</span>);
0971 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'subfunction'</span>,<span class="string">'onesubfunction'</span>,<span class="string">'onesubf'</span>);
0972 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'source'</span>,<span class="string">'thesource'</span>);
0973 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'block'</span>,<span class="string">'TPL_MFILE'</span>,<span class="string">'download'</span>,<span class="string">'downloads'</span>);
0974 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DATE'</span>,[datestr(now,8) <span class="string">' '</span> datestr(now,1) <span class="string">' '</span> <span class="keyword">...</span>
0975                             datestr(now,13)]);
0976 
0977 nblinetot = 0;
0978 <span class="keyword">for</span> i=1:length(mdir)
0979     <span class="keyword">for</span> j=1:length(mdirs)
0980         <span class="keyword">if</span> strcmp(mdirs{j},mdir{i})
0981         
0982             curfile = fullfile(options.htmlDir,mdir{i},<span class="keyword">...</span>
0983                                [names{j} options.extension]);
0984                                
0985             <span class="comment">%- Copy M-file for download, if necessary</span>
0986             <span class="keyword">if</span> options.download
0987                 <span class="keyword">if</span> options.verbose
0988                     fprintf(<span class="string">'Copying M-file %s.m to %s...\n'</span>,names{j},<span class="keyword">...</span>
0989                         fullfile(options.htmlDir,mdir{i}));
0990                 <span class="keyword">end</span>
0991                 [status, errmsg] = copyfile(mfiles{j},<span class="keyword">...</span>
0992                     fullfile(options.htmlDir,mdir{i}));
0993                 error(errmsg);
0994             <span class="keyword">end</span>
0995             
0996             <span class="comment">%- Open for writing the HTML file</span>
0997             <span class="keyword">if</span> options.verbose
0998                 fprintf(<span class="string">'Creating HTML file %s...\n'</span>,curfile);
0999             <span class="keyword">end</span>
1000             fid = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(curfile,<span class="string">'w'</span>);
1001             <span class="keyword">if</span> strcmp(names{j},options.indexFile)
1002                 fprintf([<span class="string">'Warning: HTML index file %s will be '</span> <span class="keyword">...</span>
1003                         <span class="string">'overwritten by Matlab function %s.\n'</span>], <span class="keyword">...</span>
1004                         [options.indexFile options.extension], mfiles{j});
1005             <span class="keyword">end</span>
1006             
1007             <span class="comment">%- Open for reading the M-file</span>
1008             fid2 = <a href="../m2html/private/openfile.html" class="code" title="function fid = openfile(filename,permission)">openfile</a>(mfiles{j},<span class="string">'r'</span>);
1009             
1010             <span class="comment">%- Set some template fields</span>
1011             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'INDEX'</span>, [options.indexFile options.extension]);
1012             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MASTERPATH'</span>,       <a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdir{i}));
1013             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MDIR'</span>,             mdirs{j});
1014             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME'</span>,             names{j});
1015             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE'</span>,           <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(h1line{j}));
1016             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'scriptfile'</span>,       <span class="string">''</span>);
1017             <span class="keyword">if</span> isempty(synopsis{j})
1018                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'var'</span>,<span class="string">'script'</span>));
1019             <span class="keyword">else</span>
1020                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOPSIS'</span>, synopsis{j});
1021             <span class="keyword">end</span>
1022             s = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir{i});
1023             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'pl'</span>,<span class="string">''</span>);
1024             <span class="keyword">for</span> k=1:length(s)
1025                 c = cell(1,k); <span class="keyword">for</span> l=1:k, c{l} = filesep; <span class="keyword">end</span>
1026                 cpath = {s{1:k};c{:}}; cpath = [cpath{:}];
1027                 <span class="keyword">if</span> ~isempty(cpath), cpath = cpath(1:end-1); <span class="keyword">end</span>
1028                 <span class="keyword">if</span> ismember(cpath,mdir)
1029                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,[repmat(<span class="string">'../'</span>,<span class="keyword">...</span>
1030                         1,length(s)-k) options.indexFile options.extension]);
1031                 <span class="keyword">else</span>
1032                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'LPATHDIR'</span>,<span class="string">'#'</span>);
1033                 <span class="keyword">end</span>
1034                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PATHDIR'</span>,s{k});
1035                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'pl'</span>,<span class="string">'pathline'</span>,1);
1036             <span class="keyword">end</span>
1037             
1038             <span class="comment">%- Handle mex files</span>
1039             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'mex'</span>, <span class="string">''</span>);
1040             samename = dir(fullfile(mdir{i},[names{j}    <span class="string">'.*'</span>]));
1041             samename = {samename.name};
1042             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'mex'</span>);
1043             <span class="keyword">for</span> k=1:length(samename)
1044                 [dummy, dummy, ext] = fileparts(samename{k});
1045                 <span class="keyword">switch</span> ext
1046                     <span class="keyword">case</span> <span class="string">'.c'</span>
1047                         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c'</span>);
1048                     <span class="keyword">case</span> {<span class="string">'.cpp'</span> <span class="string">'.c++'</span> <span class="string">'.cxx'</span> <span class="string">'.C'</span>}
1049                         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'c++'</span>);
1050                     <span class="keyword">case</span> {<span class="string">'.for'</span> <span class="string">'.f'</span> <span class="string">'.FOR'</span> <span class="string">'.F'</span>}
1051                         tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'MEXTYPE'</span>, <span class="string">'fortran'</span>);
1052                     <span class="keyword">otherwise</span>
1053                         <span class="comment">%- Unknown mex file source</span>
1054                 <span class="keyword">end</span>
1055             <span class="keyword">end</span>
1056             allexts = <a href="../m2html/private/mexexts.html" class="code" title="function ext = mexexts">mexexts</a>;
1057             platform = {allexts.arch};
1058             mexplatforms = sprintf(<span class="string">'%s, '</span>,platform{find(ismex(j,:))});
1059             <span class="keyword">if</span> ~isempty(mexplatforms)
1060                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'PLATFORMS'</span>, mexplatforms(1:end-2));
1061                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'mex'</span>,<span class="string">'mexfile'</span>);
1062             <span class="keyword">end</span>
1063             
1064             <span class="comment">%- Set description template field</span>
1065             descr = <span class="string">''</span>;
1066             flagsynopcont = 0;
1067             flag_seealso  = 0;
1068             <span class="keyword">while</span> 1
1069                 tline = fgets(fid2);
1070                 <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1071                 tline = <a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(fliplr(deblank(fliplr(tline))));
1072                 <span class="comment">%- Synopsis line</span>
1073                 <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'function'</span>,tline))
1074                     <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1075                         flagsynopcont = 1;
1076                     <span class="keyword">end</span>
1077                 <span class="comment">%- H1 line and description</span>
1078                 <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'%'</span>,tline))
1079                     <span class="comment">%- Hypertext links on the &quot;See also&quot; line</span>
1080                     ind = findstr(lower(tline),<span class="string">'see also'</span>);
1081                     <span class="keyword">if</span> ~isempty(ind) || flag_seealso
1082                         <span class="comment">%- &quot;See also&quot; only in files in the same directory</span>
1083                         indsamedir = find(strcmp(mdirs{j},mdirs));
1084                         hrefnames = {names{indsamedir}};
1085                         r = deblank(tline);
1086                         flag_seealso = 1; <span class="comment">%(r(end) == ',');</span>
1087                         tline = <span class="string">''</span>;
1088                         <span class="keyword">while</span> 1
1089                             [t,r,q] = <a href="../m2html/private/strtok2.html" class="code" title="function [token, remainder, quotient] = strtok2(string, delimiters)">strtok2</a>(r,sprintf(<span class="string">' \t\n\r.,;%%'</span>));
1090                             tline = [tline q];
1091                             <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>
1092                             ii = strcmpi(hrefnames,t);
1093                             <span class="keyword">if</span> any(ii)
1094                                 jj = find(ii);
1095                                 tline = [tline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1096                                     [hrefnames{jj(1)} options.extension],<span class="keyword">...</span>
1097                                     synopsis{indsamedir(jj(1))},t)];
1098                             <span class="keyword">else</span>
1099                                 tline = [tline t];
1100                             <span class="keyword">end</span>
1101                         <span class="keyword">end</span>
1102                         tline = sprintf(<span class="string">'%s\n'</span>,tline);
1103                     <span class="keyword">end</span>
1104                     descr = [descr tline(2:end)];
1105                 <span class="keyword">elseif</span> isempty(tline)
1106                     <span class="keyword">if</span> ~isempty(descr), <span class="keyword">break</span>, <span class="keyword">end</span>
1107                 <span class="keyword">else</span>
1108                     <span class="keyword">if</span> flagsynopcont
1109                         <span class="keyword">if</span> isempty(strmatch(<span class="string">'...'</span>,fliplr(deblank(tline))))
1110                             flagsynopcont = 0;
1111                         <span class="keyword">end</span>
1112                     <span class="keyword">else</span>
1113                         <span class="keyword">break</span>;
1114                     <span class="keyword">end</span>
1115                 <span class="keyword">end</span>
1116             <span class="keyword">end</span>
1117             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'DESCRIPTION'</span>,<span class="keyword">...</span>
1118                 <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(descr,options.tabs));
1119             
1120             <span class="comment">%- Set cross-references template fields:</span>
1121             <span class="comment">%  Function called</span>
1122             ind = find(hrefs(j,:) == 1);
1123             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalls'</span>,<span class="string">''</span>);
1124             <span class="keyword">for</span> k=1:length(ind)
1125                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1126                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1127                         [names{ind(k)} options.extension]);
1128                 <span class="keyword">else</span>
1129                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALL'</span>, <span class="keyword">...</span>
1130                               <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}), <span class="keyword">...</span>
1131                                          mdirs{ind(k)}, <span class="keyword">...</span>
1132                                        [names{ind(k)} options.extension]));
1133                 <span class="keyword">end</span>
1134                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALL'</span>,   synopsis{ind(k)});
1135                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALL'</span>,   names{ind(k)});
1136                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALL'</span>, h1line{ind(k)});
1137                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'crossrefcalls'</span>,<span class="string">'crossrefcall'</span>,1);
1138             <span class="keyword">end</span>
1139             <span class="comment">%  Callers</span>
1140             ind = find(hrefs(:,j) == 1);
1141             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'crossrefcalleds'</span>,<span class="string">''</span>);
1142             <span class="keyword">for</span> k=1:length(ind)
1143                 <span class="keyword">if</span> strcmp(mdirs{j},mdirs{ind(k)})
1144                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1145                         [names{ind(k)} options.extension]);
1146                 <span class="keyword">else</span>
1147                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'L_NAME_CALLED'</span>, <span class="keyword">...</span>
1148                         <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1149                             mdirs{ind(k)}, <span class="keyword">...</span>
1150                             [names{ind(k)} options.extension]));
1151                 <span class="keyword">end</span>
1152                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SYNOP_CALLED'</span>,   synopsis{ind(k)});
1153                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'NAME_CALLED'</span>,   names{ind(k)});
1154                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'H1LINE_CALLED'</span>, h1line{ind(k)});
1155                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'crossrefcalleds'</span>,<span class="string">'crossrefcalled'</span>,1);
1156             <span class="keyword">end</span>
1157             
1158             <span class="comment">%- Set subfunction template field</span>
1159             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,{<span class="string">'subf'</span> <span class="string">'onesubf'</span>},{<span class="string">''</span> <span class="string">''</span>});
1160             <span class="keyword">if</span> ~isempty(subroutine{j}) &amp;&amp; options.source
1161                 <span class="keyword">for</span> k=1:length(subroutine{j})
1162                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl, <span class="string">'var'</span>, <span class="string">'L_SUB'</span>, [<span class="string">'#_sub'</span> num2str(k)]);
1163                     tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl, <span class="string">'var'</span>, <span class="string">'SUB'</span>,   subroutine{j}{k});
1164                     tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl, <span class="string">'onesubf'</span>, <span class="string">'onesubfunction'</span>,1);
1165                 <span class="keyword">end</span>
1166                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'subf'</span>,<span class="string">'subfunction'</span>);
1167             <span class="keyword">end</span>
1168             subname = <a href="#_sub5" class="code" title="subfunction name = extractname(synopsis)">extractname</a>(subroutine{j});
1169             
1170             <span class="comment">%- Link to M-file (for download)</span>
1171             tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'downloads'</span>,<span class="string">''</span>);
1172             <span class="keyword">if</span> options.download
1173                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'downloads'</span>,<span class="string">'download'</span>,1);
1174             <span class="keyword">end</span>
1175             
1176             <span class="comment">%- Display source code with cross-references</span>
1177             <span class="keyword">if</span> options.source &amp;&amp; ~strcmpi(names{j},<span class="string">'contents'</span>)
1178                 fseek(fid2,0,-1);
1179                 it = 1;
1180                 matlabsource = <span class="string">''</span>;
1181                 nbsubroutine = 1;
1182                 <span class="comment">%- Get href function names of this file</span>
1183                 indhrefnames = find(hrefs(j,:) == 1);
1184                 hrefnames = {names{indhrefnames}};
1185                 <span class="comment">%- Loop over lines</span>
1186                 <span class="keyword">while</span> 1
1187                     tline = fgetl(fid2);
1188                     <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <span class="keyword">end</span>
1189                     myline = <span class="string">''</span>;
1190                     splitc = <a href="../m2html/private/splitcode.html" class="code" title="function splitc = splitcode(code)">splitcode</a>(<a href="#_sub8" class="code" title="subfunction str = entity(str)">entity</a>(tline));
1191                     <span class="keyword">for</span> k=1:length(splitc)
1192                         <span class="keyword">if</span> isempty(splitc{k})
1193                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'function'</span>, <span class="keyword">...</span>
1194                                         fliplr(deblank(fliplr(splitc{k})))))
1195                             <span class="keyword">if</span> isspace(splitc{k}(1))
1196                                 nbs = find(diff(isspace(splitc{k}))==-1);
1197                                 myline = [myline splitc{k}(1:nbs(1))];
1198                                 splitc{k} = splitc{k}(nbs(1)+1:end);
1199                             <span class="keyword">end</span>
1200                             <span class="comment">%- Subfunctions definition</span>
1201                             myline = [myline <span class="keyword">...</span>
1202                                 sprintf(tpl_mfile_aname,<span class="keyword">...</span>
1203                                     [<span class="string">'_sub'</span> num2str(nbsubroutine-1)],splitc{k})];
1204                             nbsubroutine = nbsubroutine + 1;
1205                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">''''</span>
1206                             myline = [myline <span class="keyword">...</span>
1207                                 sprintf(tpl_mfile_string,splitc{k})];
1208                         <span class="keyword">elseif</span> splitc{k}(1) == <span class="string">'%'</span>
1209                             myline = [myline <span class="keyword">...</span>
1210                                 sprintf(tpl_mfile_comment,deblank(splitc{k}))];
1211                         <span class="keyword">elseif</span> ~isempty(strmatch(<span class="string">'...'</span>,splitc{k}))
1212                             myline = [myline sprintf(tpl_mfile_keyword,<span class="string">'...'</span>)];
1213                             <span class="keyword">if</span> ~isempty(splitc{k}(4:end))
1214                                 myline = [myline <span class="keyword">...</span>
1215                                     sprintf(tpl_mfile_comment,splitc{k}(4:end))];
1216                             <span class="keyword">end</span>
1217                         <span class="keyword">else</span>
1218                             <span class="comment">%- Look for keywords</span>
1219                             r = splitc{k};
1220                             <span class="keyword">while</span> 1
1221                                 [t,r,q] = <a href="../m2html/private/strtok2.html" class="code" title="function [token, remainder, quotient] = strtok2(string, delimiters)">strtok2</a>(r,strtok_delim);
1222                                 myline = [myline q];
1223                                 <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>, <span class="keyword">end</span>
1224                                 <span class="comment">%- Highlight Matlab keywords &amp;</span>
1225                                 <span class="comment">%  cross-references on known functions</span>
1226                                 <span class="keyword">if</span> options.syntaxHighlighting &amp;&amp; <span class="keyword">...</span>
1227                                         any(strcmp(matlabKeywords,t))
1228                                     <span class="keyword">if</span> strcmp(<span class="string">'end'</span>,t)
1229                                         rr = fliplr(deblank(fliplr(r)));
1230                                         icomma = strmatch(<span class="string">','</span>,rr);
1231                                         isemicolon = strmatch(<span class="string">';'</span>,rr);
1232                                         <span class="keyword">if</span> ~(isempty(rr) || ~isempty([icomma isemicolon]))
1233                                             myline = [myline t];
1234                                         <span class="keyword">else</span>
1235                                             myline = [myline sprintf(tpl_mfile_keyword,t)];
1236                                         <span class="keyword">end</span>
1237                                     <span class="keyword">else</span>
1238                                         myline = [myline sprintf(tpl_mfile_keyword,t)];
1239                                     <span class="keyword">end</span>
1240                                 <span class="keyword">elseif</span> any(strcmp(hrefnames,t))
1241                                     indt = indhrefnames(logical(strcmp(hrefnames,t)));
1242                                     flink = [t options.extension];
1243                                     ii = ismember({mdirs{indt}},mdirs{j});
1244                                     <span class="keyword">if</span> ~any(ii)
1245                                         <span class="comment">% take the first one...</span>
1246                                         flink = <a href="#_sub6" class="code" title="subfunction f = fullurl(varargin)">fullurl</a>(<a href="#_sub3" class="code" title="subfunction s = backtomaster(mdir)">backtomaster</a>(mdirs{j}),<span class="keyword">...</span>
1247                                                           mdirs{indt(1)}, flink);
1248                                     <span class="keyword">else</span>
1249                                         indt = indt(logical(ii));
1250                                     <span class="keyword">end</span>
1251                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1252                                               flink, synopsis{indt(1)}, t)];
1253                                 <span class="keyword">elseif</span> any(strcmp(subname,t))
1254                                     ii = find(strcmp(subname,t));
1255                                     myline = [myline sprintf(tpl_mfile_code,<span class="keyword">...</span>
1256                                         [<span class="string">'#_sub'</span> num2str(ii)],<span class="keyword">...</span>
1257                                         [<span class="string">'sub'</span> subroutine{j}{ii}],t)];
1258                                 <span class="keyword">else</span>
1259                                     myline = [myline t];
1260                                 <span class="keyword">end</span>
1261                             <span class="keyword">end</span>
1262                         <span class="keyword">end</span>
1263                     <span class="keyword">end</span>
1264                     matlabsource = [matlabsource sprintf(tpl_mfile_line,it,myline)];
1265                     it = it + 1;
1266                 <span class="keyword">end</span>
1267                 nblinetot = nblinetot + it - 1;
1268                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'SOURCECODE'</span>,<span class="keyword">...</span>
1269                           <a href="#_sub9" class="code" title="subfunction str = horztab(str,n)">horztab</a>(matlabsource,options.tabs));
1270                 tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'thesource'</span>,<span class="string">'source'</span>);
1271             <span class="keyword">else</span>
1272                 tpl = <a href="../m2html/@template/set.html" class="code" title="function tpl = set(tpl,action,varargin)">set</a>(tpl,<span class="string">'var'</span>,<span class="string">'thesource'</span>,<span class="string">''</span>);
1273             <span class="keyword">end</span>
1274             tpl = <a href="../m2html/@template/parse.html" class="code" title="function [tpl, str] = parse(tpl,target,handle,append)">parse</a>(tpl,<span class="string">'OUT'</span>,<span class="string">'TPL_MFILE'</span>);
1275             fprintf(fid,<span class="string">'%s'</span>,<a href="../m2html/@template/get.html" class="code" title="function varargout = get(tpl,action,varargin)">get</a>(tpl,<span class="string">'OUT'</span>));
1276             fclose(fid2);
1277             fclose(fid);
1278         <span class="keyword">end</span>
1279     <span class="keyword">end</span>
1280 <span class="keyword">end</span>
1281 
1282 <span class="comment">%--------------------------------------------------------------------------</span>
1283 <span class="comment">%- Display Statistics</span>
1284 <span class="comment">%--------------------------------------------------------------------------</span>
1285 <span class="keyword">if</span> options.verbose
1286     prnbline = <span class="string">''</span>;
1287     <span class="keyword">if</span> options.source
1288         prnbline = sprintf(<span class="string">'(%d lines) '</span>, nblinetot);
1289     <span class="keyword">end</span>
1290     fprintf(<span class="string">'Stats: %d M-files %sin %d directories documented in %d s.\n'</span>, <span class="keyword">...</span>
1291             length(mfiles), prnbline, length(mdir), round(etime(clock,t0)));
1292 <span class="keyword">end</span>
1293 
1294 <span class="comment">%==========================================================================</span>
1295 <a name="_sub1" href="#_subfunctions" class="code">function mfiles = getmfiles(mdirs, mfiles, recursive,ignoredDir)</a>
1296     <span class="comment">%- Extract M-files from a list of directories and/or M-files</span>
1297 
1298     <span class="keyword">if</span> nargin &lt; 4, ignoredDir = {}; <span class="keyword">end</span>
1299     <span class="keyword">for</span> i=1:length(mdirs)
1300         currentdir = fullfile(pwd, mdirs{i});
1301         <span class="keyword">if</span> exist(currentdir) == 2 <span class="comment">% M-file</span>
1302             mfiles{end+1} = mdirs{i};
1303         <span class="keyword">elseif</span> exist(currentdir) == 7 <span class="comment">% Directory</span>
1304             d = dir(fullfile(currentdir, <span class="string">'*.m'</span>));
1305             d = {d(~[d.isdir]).name};
1306             <span class="keyword">for</span> j=1:length(d)
1307                 <span class="comment">%- don't take care of files containing ','</span>
1308                 <span class="comment">%  probably a sccs file...</span>
1309                 <span class="keyword">if</span> isempty(findstr(<span class="string">','</span>,d{j}))
1310                     mfiles{end+1} = fullfile(mdirs{i}, d{j});
1311                 <span class="keyword">end</span>
1312             <span class="keyword">end</span>
1313             <span class="keyword">if</span> recursive
1314                 d = dir(currentdir);
1315                 d = {d([d.isdir]).name};
1316                 d = {d{~ismember(d,{<span class="string">'.'</span> <span class="string">'..'</span> ignoredDir{:}})}};
1317                 <span class="keyword">for</span> j=1:length(d)
1318                     mfiles = <a href="#_sub1" class="code" title="subfunction mfiles = getmfiles(mdirs, mfiles, recursive,ignoredDir)">getmfiles</a>(cellstr(fullfile(mdirs{i},d{j})), <span class="keyword">...</span>
1319                                        mfiles, recursive);
1320                 <span class="keyword">end</span>
1321             <span class="keyword">end</span>
1322         <span class="keyword">else</span>
1323             fprintf(<span class="string">'Warning: Unprocessed file %s.\n'</span>,mdirs{i});
1324             <span class="keyword">if</span> ~isempty(strmatch(<span class="string">'/'</span>,mdirs{i})) || findstr(<span class="string">':'</span>,mdirs{i})
1325                 fprintf(<span class="string">'         Use relative paths in ''mfiles'' option\n'</span>);
1326             <span class="keyword">end</span> 
1327         <span class="keyword">end</span>
1328     <span class="keyword">end</span>
1329 
1330 <span class="comment">%==========================================================================</span>
1331 <a name="_sub2" href="#_subfunctions" class="code">function calldot(dotexec, mdotfile, mapfile, pngfile, opt)</a>
1332     <span class="comment">%- Draw a dependency graph in a PNG image using &lt;dot&gt; from GraphViz</span>
1333 
1334     <span class="keyword">if</span> nargin == 4, opt = <span class="string">''</span>; <span class="keyword">end</span>
1335     <span class="keyword">try</span>
1336         <span class="comment">%- See &lt;http://www.graphviz.org/&gt;</span>
1337         <span class="comment">%  &lt;dot&gt; must be in your system path, see M2HTML FAQ:</span>
1338         <span class="comment">%  &lt;http://www.artefact.tk/software/matlab/m2html/faq.php&gt;</span>
1339 
1340         system([<span class="string">'&quot;'</span> dotexec <span class="string">'&quot; '</span> opt <span class="string">' -Tcmap -Tpng &quot;'</span> mdotfile <span class="keyword">...</span>
1341               <span class="string">'&quot; -o &quot;'</span> mapfile <span class="keyword">...</span><span class="comment"> </span>
1342               <span class="string">'&quot; -o &quot;'</span> pngfile <span class="string">'&quot;'</span>]);
1343     <span class="keyword">catch</span> <span class="comment">% use of '!' prevents errors to be catched...</span>
1344         fprintf(<span class="string">'&lt;dot&gt; failed.'</span>);
1345     <span class="keyword">end</span>
1346     
1347 <span class="comment">%==========================================================================</span>
1348 <a name="_sub3" href="#_subfunctions" class="code">function s = backtomaster(mdir)</a>
1349     <span class="comment">%- Provide filesystem path to go back to the root folder</span>
1350 
1351     ldir = <a href="#_sub4" class="code" title="subfunction ldir = splitpath(p)">splitpath</a>(mdir);
1352     s = repmat(<span class="string">'../'</span>,1,length(ldir));
1353     
1354 <span class="comment">%==========================================================================</span>
1355 <a name="_sub4" href="#_subfunctions" class="code">function ldir = splitpath(p)</a>
1356     <span class="comment">%- Split a filesystem path into parts using filesep as separator</span>
1357 
1358     ldir = {};
1359     p = deblank(p);
1360     <span class="keyword">while</span> 1
1361         [t,p] = strtok(p,filesep);
1362         <span class="keyword">if</span> isempty(t), <span class="keyword">break</span>; <span class="keyword">end</span>
1363         <span class="keyword">if</span> ~strcmp(t,<span class="string">'.'</span>)
1364             ldir{end+1} = t;
1365         <span class="keyword">end</span>
1366     <span class="keyword">end</span>
1367     <span class="keyword">if</span> isempty(ldir)
1368         ldir{1} = <span class="string">'.'</span>; <span class="comment">% should be removed</span>
1369     <span class="keyword">end</span>
1370 
1371 <span class="comment">%==========================================================================</span>
1372 <a name="_sub5" href="#_subfunctions" class="code">function name = extractname(synopsis)</a>
1373     <span class="comment">%- Extract function name in a synopsis</span>
1374 
1375     <span class="keyword">if</span> ischar(synopsis), synopsis = {synopsis}; <span class="keyword">end</span>
1376     name = cell(size(synopsis));
1377     <span class="keyword">for</span> i=1:length(synopsis)
1378         ind = findstr(synopsis{i},<span class="string">'='</span>);
1379         <span class="keyword">if</span> isempty(ind)
1380             ind = findstr(synopsis{i},<span class="string">'function'</span>);
1381             s = synopsis{i}(ind(1)+8:end);
1382         <span class="keyword">else</span>
1383             s = synopsis{i}(ind(1)+1:end);
1384         <span class="keyword">end</span>
1385         name{i} = strtok(s,[9:13 32 40]); <span class="comment">% white space characters and '('</span>
1386     <span class="keyword">end</span>
1387     <span class="keyword">if</span> length(name) == 1, name = name{1}; <span class="keyword">end</span>
1388 
1389 <span class="comment">%==========================================================================</span>
1390 <a name="_sub6" href="#_subfunctions" class="code">function f = fullurl(varargin)</a>
1391     <span class="comment">%- Build full url from parts (using '/' and not filesep)</span>
1392     
1393     f = strrep(fullfile(varargin{:}),<span class="string">'\'</span>,<span class="string">'/'</span>);
1394 
1395 <span class="comment">%==========================================================================</span>
1396 <a name="_sub7" href="#_subfunctions" class="code">function str = escapeblank(str)</a>
1397     <span class="comment">%- Escape white spaces using '\'</span>
1398     
1399     str = deblank(fliplr(deblank(fliplr(str))));
1400     <span class="comment">%str = strrep(str,' ','\ ');</span>
1401 
1402 <span class="comment">%==========================================================================</span>
1403 <a name="_sub8" href="#_subfunctions" class="code">function str = entity(str)</a>
1404     <span class="comment">%- Escape HTML special characters</span>
1405     <span class="comment">%- See http://www.w3.org/TR/html4/charset.html#h-5.3.2</span>
1406     
1407     str = strrep(str,<span class="string">'&amp;'</span>,<span class="string">'&amp;amp;'</span>);
1408     str = strrep(str,<span class="string">'&lt;'</span>,<span class="string">'&amp;lt;'</span>);
1409     str = strrep(str,<span class="string">'&gt;'</span>,<span class="string">'&amp;gt;'</span>);
1410     str = strrep(str,<span class="string">'&quot;'</span>,<span class="string">'&amp;quot;'</span>);
1411     
1412 <span class="comment">%==========================================================================</span>
1413 <a name="_sub9" href="#_subfunctions" class="code">function str = horztab(str,n)</a>
1414     <span class="comment">%- For browsers, the horizontal tab character is the smallest non-zero</span>
1415     <span class="comment">%- number of spaces necessary to line characters up along tab stops that are</span>
1416     <span class="comment">%- every 8 characters: behaviour obtained when n = 0.</span>
1417     
1418     <span class="keyword">if</span> n &gt; 0
1419         str = strrep(str,sprintf(<span class="string">'\t'</span>),blanks(n));
1420     <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 30-Aug-2019 15:00:34 by <strong><a href="https://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003-2019</address>
</body>
</html>